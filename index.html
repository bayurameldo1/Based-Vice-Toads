<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Based Vice Toads â€” Mint & Claim</title>
  <link rel="icon" href="https://vice-toads.vercel.app/images/icon.png" />

  <!-- Farcaster Miniapp Embed -->
  <meta name="fc:miniapp" content='{
    "version":"next",
    "imageUrl":"https://vice-toads.vercel.app/images/bg1.jpg",
    "button":{
        "title":"Mint Now",
        "action":{
        "type":"launch_miniapp",
        "name":"Based Vice Toads",
        "url":"https://vice-toads.vercel.app"
        }
    }
  }' />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
    :root{
      --bg:#05020a; --pink:#ff6fb3; --card1:#ffb6d7; --card2:#ff8fca; --accent:#00f2d6;
    }
    html,body{height:100%;margin:0;background:var(--bg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#fff}
    .wrap{max-width:980px;margin:0 auto;padding:12px}
    .marquee{overflow:hidden;white-space:nowrap;padding:6px 0;text-align:center;color:var(--accent);font-weight:700}

    /* HERO: adjusted sizes only */
    .hero{
      position:relative;
      /* make hero panoramic approx 1536x1024 => aspect-ratio 3/2 */
      width:100%;
      aspect-ratio: 3 / 2;
      border-radius:10px;
      overflow:hidden;
      margin-top:8px;
      box-shadow:0 18px 60px rgba(0,0,0,.7);
      background:#000;
    }

    .slider{display:flex;height:100%;width:400%;animation:slide-left 24s linear infinite}
    .slide{min-width:100%;height:100%;background-size:cover;background-position:center; background-repeat:no-repeat; transition: transform .45s ease;}
    /* emphasize the middle (second) slide slightly so it looks larger */
    .slide:nth-child(2){ transform: scale(1.03); }

    @keyframes slide-left{
      0%{transform:translateX(0)}20%{transform:translateX(0)}
      30%{transform:translateX(-100%)}50%{transform:translateX(-100%)}
      60%{transform:translateX(-200%)}80%{transform:translateX(-200%)}
      90%{transform:translateX(-300%)}100%{transform:translateX(-300%)}
    }
    .overlay{position:absolute;z-index:6;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none}
    .title{font-size:48px;letter-spacing:6px;margin:0;color:#ffd6ec;text-shadow:0 10px 30px rgba(0,0,0,.7);text-transform:uppercase;font-weight:800;animation:wave 2.8s ease-in-out infinite}
    @keyframes wave{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
    .controls{pointer-events:auto;margin-top:16px;display:flex;align-items:center;gap:12px}
    .mint-btn{background:var(--pink);border-radius:28px;padding:12px 28px;border:none;color:#071018;font-weight:800;cursor:pointer;box-shadow:0 8px 30px rgba(255,111,179,.12)}
    .logos{display:flex;gap:10px;align-items:center}
    .logo{width:44px;height:44px;border-radius:8px;overflow:hidden;background:#fff;padding:6px;display:flex;align-items:center;justify-content:center}
    .logo img{width:28px;height:28px;object-fit:contain}

    /* profile card */
    .card{width:92%;max-width:420px;margin:18px auto;padding:16px;border-radius:12px;background:linear-gradient(180deg,var(--card1),var(--card2));color:#071018;box-shadow:0 14px 40px rgba(0,0,0,.48)}
    .card .row{display:flex;align-items:center;gap:12px}
    .avatar{width:56px;height:56px;border-radius:50%;overflow:hidden;background:#fff;flex:0 0 56px}
    .avatar img{width:56px;height:56px;object-fit:cover}
    .name{font-weight:800}
    .sub{font-size:12px;color:#071018;opacity:.7}
    .points{font-weight:900;font-size:20px;margin-top:10px}
    .claim-row{display:flex;gap:10px;margin-top:12px}
    .btn{padding:10px 12px;border-radius:10px;border:none;cursor:pointer;font-weight:800}
    .btn-connect{background:#071018;color:var(--card1);flex:1}
    .btn-claim{background:rgba(11,7,16,.18);color:#fff;min-width:140px}
    .disabled{opacity:.45;pointer-events:none}

    /* bottom image: force square (1:1) like 1024x1024 */
    .bottom{margin-top:20px;display:flex;justify-content:center}
    .bottom img{max-width:100%;border-radius:10px; aspect-ratio: 1 / 1; object-fit:cover}

    @media(max-width:520px){ .title{font-size:34px} .hero{aspect-ratio: 4 / 3;} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="marquee" id="marTop">ðŸŸ¦ Join The Waitlist ðŸŸ¦ &nbsp; ðŸŸ¦ Join The Waitlist ðŸŸ¦</div>

    <section class="hero">
      <div class="slider">
        <div class="slide" style="background-image:url('https://vice-toads.vercel.app/images/bg1.jpg')"></div>
        <div class="slide" style="background-image:url('https://vice-toads.vercel.app/images/bg2.jpg')"></div>
        <div class="slide" style="background-image:url('https://vice-toads.vercel.app/images/bg3.jpg')"></div>
        <div class="slide" style="background-image:url('https://vice-toads.vercel.app/images/bg4.jpg')"></div>
      </div>

      <div class="overlay">
        <h1 class="title">MINT NOW</h1>

        <div class="controls">
          <button id="mintBtn" class="mint-btn">MINT NOW</button>

          <div class="logos">
            <a class="logo" href="https://farcaster.xyz/ameldoxg" target="_blank" title="Farcaster">
              <img src="https://vice-toads.vercel.app/images/farcaster.png" alt="farcaster" />
            </a>
            <a class="logo" href="https://base.app/profile/0xbres" target="_blank" title="Base App">
              <img src="https://vice-toads.vercel.app/images/baseapp.png" alt="baseapp" />
            </a>
          </div>
        </div>
      </div>
    </section>

    <!-- profile / claim card -->
    <div class="card" id="profileCard">
      <div class="row">
        <div class="avatar"><img id="avatarImg" src="https://vice-toads.vercel.app/images/icon.png" alt="avatar" /></div>
        <div style="flex:1">
          <div class="name" id="profileName">Not connected</div>
          <div class="sub" id="profileSub">Connect wallet to show profile</div>
        </div>
      </div>

      <div class="points">+100 Vice Toads$ <div style="font-size:12px;color:#071018;opacity:.7;margin-top:6px">Total Claimed: <span id="totalClaimed">0</span></div></div>

      <div class="claim-row">
        <button id="connectBtn" class="btn btn-connect">Connect Wallet</button>
        <button id="claimBtn" class="btn btn-claim disabled" disabled>Claim +100</button>
      </div>

      <div style="margin-top:10px;color:#071018" id="statusText">Connect your wallet to claim</div>
    </div>

    <div class="bottom">
      <!-- Bottom image now using square (bg5) -->
      <img src="https://vice-toads.vercel.app/images/bg5.jpg" alt="bottom" />
    </div>

    <div style="height:48px"></div>
    <div class="marquee" id="marBottom">ðŸŸ¦ Join The Waitlist ðŸŸ¦ &nbsp; ðŸŸ¦ Join The Waitlist ðŸŸ¦</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
  <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>

  <script>
    (function(){
      const INFURA_ID = "REPLACE_WITH_INFURA_PROJECT_ID";
      const FARCASTER_API = "/api/farcaster";
      const CLAIM_API = "/api/claim";

      const connectBtn = document.getElementById('connectBtn');
      const claimBtn = document.getElementById('claimBtn');
      const profileName = document.getElementById('profileName');
      const profileSub = document.getElementById('profileSub');
      const avatarImg = document.getElementById('avatarImg');
      const statusText = document.getElementById('statusText');
      const totalClaimedEl = document.getElementById('totalClaimed');
      const mintBtn = document.getElementById('mintBtn');

      let provider = null, web3 = null, currentAddress = null;
      const LS_KEY = "vct_claims_v1";

      const providerOptions = {
        walletconnect: {
          package: window.WalletConnectProvider.default,
          options: {
            rpc: { 1: "https://mainnet.infura.io/v3/" + INFURA_ID },
            bridge: "https://bridge.walletconnect.org"
          }
        }
      };
      const web3Modal = new window.Web3Modal.default({ cacheProvider:false, providerOptions });

      function short(a){ return a ? (a.slice(0,6) + "..." + a.slice(-4)) : ""; }

      connectBtn.addEventListener('click', async ()=>{
        try {
          provider = await web3Modal.connect();
          web3 = new Web3(provider);
          const accounts = await web3.eth.getAccounts();
          currentAddress = accounts[0].toLowerCase();
          profileName.textContent = short(currentAddress);
          profileSub.textContent = "Detecting Farcaster profile...";
          connectBtn.textContent = "Connected";
          claimBtn.classList.remove('disabled'); claimBtn.disabled = false;

          try {
            const res = await fetch(FARCASTER_API + "?address=" + currentAddress);
            if (res.ok){
              const j = await res.json();
              if (j.ok && j.profile){
                const p = j.profile;
                profileName.textContent = p.username || p.displayName || short(currentAddress);
                profileSub.textContent = short(currentAddress);
                avatarImg.src = p.avatar || "https://vice-toads.vercel.app/images/icon.png";
              }
            }
          } catch(e){ console.warn("farcaster lookup failed"); }

          loadTotals();
          statusText.textContent = "Ready to claim your points";
        } catch(e){
          statusText.textContent = "Wallet connection failed";
        }
      });

      claimBtn.addEventListener('click', async ()=>{
        if (!currentAddress){ alert("Connect wallet first"); return; }
        statusText.textContent = "Processing claim...";
        claimBtn.disabled = true;
        try {
          const resp = await fetch(CLAIM_API, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ address: currentAddress, amount:100 }) });
          const j = await resp.json();
          if (j.ok){
            totalClaimedEl.textContent = j.total || 0;
            statusText.textContent = "Claimed +100 â€” next claim in 24h";
          } else {
            statusText.textContent = j.error || "Claim failed";
          }
        } catch(e){
          statusText.textContent = "Offline claim mode";
          localClaim();
        } finally { claimBtn.disabled = false; }
      });

      function localClaim(){
        const db = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
        const rec = db[currentAddress] || { total:0, last:0 };
        const now = Date.now(), day = 24*60*60*1000;
        if (now - rec.last < day){
          statusText.textContent = "Cooldown active";
          return;
        }
        rec.total += 100; rec.last = now;
        db[currentAddress] = rec; localStorage.setItem(LS_KEY, JSON.stringify(db));
        totalClaimedEl.textContent = rec.total;
        statusText.textContent = "Claimed +100 â€” next in 24h";
      }

      function loadTotals(){
        const db = JSON.parse(localStorage.getItem(LS_KEY) || "{}");
        const rec = db[currentAddress] || { total:0 };
        totalClaimedEl.textContent = rec.total || 0;
      }

      mintBtn.addEventListener('click', ()=> window.open('https://opensea.io/collection/based-vice-toads','_blank'));
    })();
  </script>
</body>
</html>
